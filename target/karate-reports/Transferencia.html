<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link rel="stylesheet" href="res/bootstrap.min.css" type="text/css"/>
    <link rel="stylesheet" href="res/karate-report.css" type="text/css"/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <script type="text/javascript" src="res/jquery.min.js"></script>
    <script type="text/javascript" src="res/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="res/jquery-ui.min.js"></script>
    <script type="text/javascript" src="res/bootstrap.min.js"></script>
    <script type="text/javascript" src="res/karate-report.js"></script>
    <script type="text/javascript" src="res/Resemble.js"></script>
    <script>
!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
posthog.init('phc_M6fKk3dSX9HjglkqPSybauGas45NINb7EgsPGU8N9g1',{
  api_host:'https://app.posthog.com',
  persistence:'localStorage',
  autocapture:false,
  capture_pageview:false,
  api_transport:'sendBeacon',
  loaded: function(posthog) { 
    posthog.capture("report_feature",{distinct_id:"22b3d616-2081-4529-ac92-6540882b6035",karate_version:"1.4.0",karate_meta:null});
  }
});
</script>

    <title>Transferencia</title>
  </head>
  <body>
    <div id="root-container">
      <div id="leftnav">
        
        <div>
  <div class="nav-logo">
    <a href="https://karatelabs.io">
      <img src="karate-labs-logo-ring.svg" alt="Karate Labs"/>
    </a>
    <div class="nav-count">
      <div id="nav-pass" class="bg-success">0</div>
      <div id="nav-fail" class="bg-danger">25</div>
    </div>
  </div>
  <div id="nav-env">
    <div></div>
  </div>
  <div id="nav-type">
    <div>Scenarios</div>
  </div>
  <div id="nav-date">
    <div>2025-10-22 02:15:30 p.Â m.</div>
  </div>
</div>

        <div class="nav-container">
          <div class="nav-item failed">
            <a href="#[1:158]"><span>[1:158]</span> <span>Transferencia exitosa con credenciales validas</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[2:169]"><span>[2:169]</span> <span>Transferencia exitosa mediante QR entre dos clientes de la misma entidad (ordenante CTA Ahorro, receptor CTA Corriente)</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[3:180]"><span>[3:180]</span> <span>Transferencia exitosa entre dos clientes de la misma entidad (ordenante CTA Corriente, receptor CTA Corriente)</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[4:191]"><span>[4:191]</span> <span>Transferencia exitosa entre dos clientes de diferentes entidades (ordenante local CTA Corriente, receptor intraredes CTA Corriente)</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[5:202]"><span>[5:202]</span> <span>Transferencia no exitosa, el codigo IBAN es el mismo del ordenante y receptor</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[6:213]"><span>[6:213]</span> <span>Transferencia no exitosa, el codigo EndToEnd es el mismo del ordenante y receptor</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[7:234]"><span>[7:234]</span> <span>Transferencia no exitosa, el codigo MsgId es el mismo del ordenante y receptor</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[8:255]"><span>[8:255]</span> <span>Transferencia no exitosa, numero de transacciones diarias superior al permitido</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[9:266]"><span>[9:266]</span> <span>Transferencia no exitosa, monto maximo con decimales por transaccion</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[10:277]"><span>[10:277]</span> <span>Transferencia no exitosa, monto maximo entero por transaccion</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[11:288]"><span>[11:288]</span> <span>Transferencia no exitosa, monto minimo con valor decimal de 2.99</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[12:299]"><span>[12:299]</span> <span>Transferencia no exitosa, monto minimo entero de 1.00</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[13:310]"><span>[13:310]</span> <span>Transferencia no exitosa, monto 0.00</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[14:321]"><span>[14:321]</span> <span>Validar limites por transacciones de usuario, monto acumulado diario superior al permitido</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[15:332]"><span>[15:332]</span> <span>Validar limites por transacciones de usuario, monto acumulado mensual superior al permitido</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[16:343]"><span>[16:343]</span> <span>Transferencia exitosa, monto total diario permitido despues de modificar el parametro</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[17:355]"><span>[17:355]</span> <span>Transferencia exitosa, monto total mensual permitido despues de modificar el parametro</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[18:367]"><span>[18:367]</span> <span>Transferencia no exitosa, fondos insuficientes</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[19:378]"><span>[19:378]</span> <span>Transferencia no exitosa, cuenta ordenante bloqueada en el directorio</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[20:390]"><span>[20:390]</span> <span>Transferencia exitosa, cuenta ordenante desbloqueada en el directorio</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[21:402]"><span>[21:402]</span> <span>Transferencia no exitosa mediante QR, cuenta receptora desafiliada en el directorio</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[22:414]"><span>[22:414]</span> <span>Transferencia no exitosa, cuenta receptora bloqueada en el directorio</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[23:426]"><span>[23:426]</span> <span>Transferencia exitosa, cuenta receptora desbloqueada en el directorio</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[24:438]"><span>[24:438]</span> <span>Transferencia no exitosa, debito aplicado y switch detenido</span></a>
          </div>
          <div class="nav-item failed">
            <a href="#[25:450]"><span>[25:450]</span> <span>Transferencia no exitosa, token caducado o expirado</span></a>
          </div>
        </div>
      </div>
      <div id="content">
        <div class="page-heading alert alert-primary">
          <a href="karate-summary.html">Summary</a><span class="feature-label">|</span>
          <a href="karate-tags.html">Tags</a><span class="feature-label">|</span>
          <span class="feature-label">Feature:</span>
          <span class="feature-path">Transferencia.feature</span><span class="feature-label">|</span>
          <span class="feature-name">Transferencias financieras PANAPAY</span>
          <span class="feature-description"></span>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[1:158]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[1:158]</span>
                <span class="scenario-name">Transferencia exitosa con credenciales validas</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>12693</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[1:158]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1754</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:18.092 &lt;&lt; lock released, cached callonce: read(&#39;classpath:helpers/generate-token.feature&#39;)
</div>   

  <div>
        
    <div class="step-row">
      <div class="step-container" id="0.5.0.call">
        <div class="step-ref bg-step">&gt;&gt;</div>
        <div class="step-indent"></div>
        <div class="step-cell passed">helpers.generate-token</div>
      </div>
      <div class="time-cell passed">1600</div>
    </div>
    <div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.4">
      <div class="step-ref bg-step">4</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def projectDir = karate.properties[&#39;karate.project.dir&#39;] ? karate.properties[&#39;karate.project.dir&#39;] : java.lang.System.getProperty(&#39;user.dir&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">31</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5.0.call.0.4">14:14:15.864 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
14:14:16.373 &gt;&gt; lock acquired, begin callonce: read(&#39;classpath:helpers/generate-token.feature&#39;)
14:14:16.415 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.5">
      <div class="step-ref bg-step">5</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def Paths = Java.type(&#39;java.nio.file.Paths&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">13</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.6">
      <div class="step-ref bg-step">6</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenDirectory = Paths.get(projectDir, &#39;target&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">9</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.7">
      <div class="step-ref bg-step">7</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenTextPath = tokenDirectory.resolve(&#39;token.txt&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">14</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.8">
      <div class="step-ref bg-step">8</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenJsonPath = tokenDirectory.resolve(&#39;token-data.json&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.9">
      <div class="step-ref bg-step">9</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenResponsePath = tokenDirectory.resolve(&#39;token-response.json&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container">
      <div class="step-ref passed"></div>
      <div class="step-indent"></div>
      <div class="step-cell comment"># Solicita el token con grant client_credentials utilizando las credenciales QA.</div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.13">
      <div class="step-ref bg-step">13</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def clientId = &#39;0205cb&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.14">
      <div class="step-ref bg-step">14</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def clientSecret = &#39;iXaIz03uhylB2nG6jxTLz2QdHs37GbXn&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.15">
      <div class="step-ref bg-step">15</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>url &#39;https://autenticacionqa.coonecta.com.ec/auth/realms/PANAPAY/protocol/openid-connect/token&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.16">
      <div class="step-ref bg-step">16</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>header Content-Type = &#39;application/x-www-form-urlencoded&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.17">
      <div class="step-ref bg-step">17</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>form field grant_type = &#39;client_credentials&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">180</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.18">
      <div class="step-ref bg-step">18</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>form field client_id = clientId</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.19">
      <div class="step-ref bg-step">19</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>form field client_secret = clientSecret</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.20">
      <div class="step-ref bg-step">20</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">859</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5.0.call.0.20">14:14:16.920 request:
1 &gt; POST https://autenticacionqa.coonecta.com.ec/auth/realms/PANAPAY/protocol/openid-connect/token
1 &gt; Content-Type: application/x-www-form-urlencoded
1 &gt; Content-Length: 93
1 &gt; Host: autenticacionqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
grant_type=client_credentials&amp;client_id=0205cb&amp;client_secret=iXaIz03uhylB2nG6jxTLz2QdHs37GbXn

14:14:17.547 response time in milliseconds: 620
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:14:10 GMT
1 &lt; Content-Type: application/json
1 &lt; Content-Length: 1492
1 &lt; Connection: keep-alive
1 &lt; Cache-Control: no-store
1 &lt; Pragma: no-cache
1 &lt; Referrer-Policy: no-referrer
1 &lt; Strict-Transport-Security: max-age=31536000; includeSubDomains
1 &lt; X-Content-Type-Options: nosniff
{&quot;access_token&quot;:&quot;eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ&quot;,&quot;expires_in&quot;:300,&quot;refresh_expires_in&quot;:0,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;not-before-policy&quot;:0,&quot;scope&quot;:&quot;profile email&quot;}

</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.21">
      <div class="step-ref bg-step">21</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>Then</span>&nbsp;<span>status 200</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.22">
      <div class="step-ref bg-step">22</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def jsonResponse = response</span>
      </div>
    </div>
    <div class="time-cell passed">7</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.23">
      <div class="step-ref bg-step">23</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def codecb = clientId.substring(0, 4)</span>
      </div>
    </div>
    <div class="time-cell passed">30</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.24">
      <div class="step-ref bg-step">24</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def formattedDate = java.time.LocalDate.now().format(java.time.format.DateTimeFormatter.ofPattern(&#39;yyyyMMdd&#39;))</span>
      </div>
    </div>
    <div class="time-cell passed">18</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.25">
      <div class="step-ref bg-step">25</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match jsonResponse.access_token != null</span>
      </div>
    </div>
    <div class="time-cell passed">60</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.26">
      <div class="step-ref bg-step">26</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenInfo =</span>
      </div>
    </div>
    <div class="time-cell passed">9</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.5.0.call.0.26">{
  currentDate: &#39;#(formattedDate)&#39;,
  coop_codecb: &#39;#(codecb)&#39;,
  auth_tokencb: &#39;#(jsonResponse.access_token)&#39;
}</div>

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.34">
      <div class="step-ref bg-step">34</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set tokenInfo.responseStatus = responseStatus</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.35">
      <div class="step-ref bg-step">35</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set tokenInfo.rawResponse = jsonResponse</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.36">
      <div class="step-ref bg-step">36</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def Files = Java.type(&#39;java.nio.file.Files&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.37">
      <div class="step-ref bg-step">37</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def StandardCharsets = Java.type(&#39;java.nio.charset.StandardCharsets&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.38">
      <div class="step-ref bg-step">38</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def ObjectMapper = Java.type(&#39;com.fasterxml.jackson.databind.ObjectMapper&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.39">
      <div class="step-ref bg-step">39</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def mapper = new ObjectMapper()</span>
      </div>
    </div>
    <div class="time-cell passed">30</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.40">
      <div class="step-ref bg-step">40</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval Files.createDirectories(tokenDirectory)</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.41">
      <div class="step-ref bg-step">41</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set tokenInfo.tokenPath = tokenTextPath</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.42">
      <div class="step-ref bg-step">42</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set tokenInfo.tokenJsonPath = tokenJsonPath</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.43">
      <div class="step-ref bg-step">43</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set tokenInfo.tokenResponsePath = tokenResponsePath</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.44">
      <div class="step-ref bg-step">44</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval Files.write(Paths.get(tokenTextPath), tokenInfo.auth_tokencb.getBytes(StandardCharsets.UTF_8))</span>
      </div>
    </div>
    <div class="time-cell passed">24</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.45">
      <div class="step-ref bg-step">45</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval Files.write(Paths.get(tokenJsonPath), mapper.writeValueAsBytes(tokenInfo))</span>
      </div>
    </div>
    <div class="time-cell passed">142</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.46">
      <div class="step-ref bg-step">46</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval Files.write(Paths.get(tokenResponsePath), mapper.writeValueAsBytes({ status: responseStatus, response: jsonResponse }))</span>
      </div>
    </div>
    <div class="time-cell passed">15</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.47">
      <div class="step-ref bg-step">47</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>karate.log(&#39;Token almacenado en:&#39;, tokenTextPath)</span>
      </div>
    </div>
    <div class="time-cell passed">9</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5.0.call.0.47">14:14:17.922 Token almacenado en: C:\Users\aromero\OneDrive - RED TRANSACCIONAL COOPERATIVA RTC COONECTA\Escritorio\PRUEBA - TATA\Karate-EJERCICIO2\target\token.txt 
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.48">
      <div class="step-ref bg-step">48</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>karate.log(&#39;Detalle crudo almacenado en:&#39;, tokenResponsePath)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5.0.call.0.48">14:14:17.922 Detalle crudo almacenado en: C:\Users\aromero\OneDrive - RED TRANSACCIONAL COOPERATIVA RTC COONECTA\Escritorio\PRUEBA - TATA\Karate-EJERCICIO2\target\token-response.json 
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.49">
      <div class="step-ref bg-step">49</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def result = tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
    </div>
    <div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.4">
      <div class="step-ref bg-step">4</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def projectDir = karate.properties[&#39;karate.project.dir&#39;] ? karate.properties[&#39;karate.project.dir&#39;] : java.lang.System.getProperty(&#39;user.dir&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5.0.call.0.4">14:14:17.944 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.5">
      <div class="step-ref bg-step">5</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def Paths = Java.type(&#39;java.nio.file.Paths&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.6">
      <div class="step-ref bg-step">6</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenDirectory = Paths.get(projectDir, &#39;target&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.7">
      <div class="step-ref bg-step">7</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenTextPath = tokenDirectory.resolve(&#39;token.txt&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.8">
      <div class="step-ref bg-step">8</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenJsonPath = tokenDirectory.resolve(&#39;token-data.json&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.9">
      <div class="step-ref bg-step">9</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenResponsePath = tokenDirectory.resolve(&#39;token-response.json&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.52">
      <div class="step-ref bg-step">52</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def savedToken = read(&#39;file:&#39; + tokenJsonPath)</span>
      </div>
    </div>
    <div class="time-cell passed">34</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.53">
      <div class="step-ref bg-step">53</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match savedToken.auth_tokencb != null</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.54">
      <div class="step-ref bg-step">54</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match savedToken.responseStatus == 200</span>
      </div>
    </div>
    <div class="time-cell passed">11</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.55">
      <div class="step-ref bg-step">55</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def today = java.time.LocalDate.now().format(java.time.format.DateTimeFormatter.ofPattern(&#39;yyyyMMdd&#39;))</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.56">
      <div class="step-ref bg-step">56</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match savedToken.currentDate == today</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.57">
      <div class="step-ref bg-step">57</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match savedToken.coop_codecb == &#39;0205&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.58">
      <div class="step-ref bg-step">58</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def responseEnvelope = read(&#39;file:&#39; + tokenResponsePath)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.59">
      <div class="step-ref bg-step">59</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match responseEnvelope.status == savedToken.responseStatus</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
    </div>
    <div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.4">
      <div class="step-ref bg-step">4</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def projectDir = karate.properties[&#39;karate.project.dir&#39;] ? karate.properties[&#39;karate.project.dir&#39;] : java.lang.System.getProperty(&#39;user.dir&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5.0.call.0.4">14:14:18.043 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.5">
      <div class="step-ref bg-step">5</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def Paths = Java.type(&#39;java.nio.file.Paths&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.6">
      <div class="step-ref bg-step">6</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenDirectory = Paths.get(projectDir, &#39;target&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.7">
      <div class="step-ref bg-step">7</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenTextPath = tokenDirectory.resolve(&#39;token.txt&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.8">
      <div class="step-ref bg-step">8</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenJsonPath = tokenDirectory.resolve(&#39;token-data.json&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.9">
      <div class="step-ref bg-step">9</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenResponsePath = tokenDirectory.resolve(&#39;token-response.json&#39;).toString()</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.62">
      <div class="step-ref bg-step">62</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def rawToken = karate.readAsString(&#39;file:&#39; + tokenTextPath).trim()</span>
      </div>
    </div>
    <div class="time-cell passed">15</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.63">
      <div class="step-ref bg-step">63</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>assert rawToken.length() &gt; 20</span>
      </div>
    </div>
    <div class="time-cell passed">16</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.64">
      <div class="step-ref bg-step">64</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def savedToken = read(&#39;file:&#39; + tokenJsonPath)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.65">
      <div class="step-ref bg-step">65</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match savedToken.auth_tokencb == rawToken</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.66">
      <div class="step-ref bg-step">66</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>match savedToken.tokenPath == tokenTextPath</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.67">
      <div class="step-ref bg-step">67</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenInfo = savedToken</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
      <div><div>
  

  

  <div class="step-row" data-parent="0.5.0.call">
    <div class="step-container" id="0.5.0.call.0.68">
      <div class="step-ref bg-step">68</div>
      <div class="step-indent"></div>
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def result = tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
    </div>    
  </div>

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">27</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">82</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">13</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[1:158]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.159">
      <div class="step-ref passed">159</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload()</span>
      </div>
    </div>
    <div class="time-cell passed">51</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.160">
      <div class="step-ref passed">160</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.161">
      <div class="step-ref passed">161</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">66</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.162">
      <div class="step-ref passed">162</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.163">
      <div class="step-ref passed">163</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.164">
      <div class="step-ref passed">164</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">10680</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.164">14:14:18.372 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 509
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102271886075182&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:18&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102208648&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:29.038 response time in milliseconds: 10564
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:14:20 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020354&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:17&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102271886075182&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:18&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102208648&quot;,&quot;TxId&quot;:&quot;18535&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141419624766&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141420061137&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.165">
      <div class="step-ref failed">165</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.165">14:14:29.042 classpath:Transferencia.feature:165
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:165
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.166">
      <div class="step-ref skipped">166</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.167">
      <div class="step-ref skipped">167</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Transferencia exitosa con credenciales validas&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[2:169]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[2:169]</span>
                <span class="scenario-name">Transferencia exitosa mediante QR entre dos clientes de la misma entidad (ordenante CTA Ahorro, receptor CTA Corriente)</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>919</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[2:169]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">8</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:29.148 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[2:169]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.170">
      <div class="step-ref passed">170</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ channel: &#39;QR&#39;, debtorAccountType: &#39;CTA_AHORROS&#39;, creditorAccountType: &#39;CTA_CORRIENTE&#39;, channelReference: &#39;QR-APP&#39; })</span>
      </div>
    </div>
    <div class="time-cell passed">11</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.171">
      <div class="step-ref passed">171</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.172">
      <div class="step-ref passed">172</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.173">
      <div class="step-ref passed">173</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.174">
      <div class="step-ref passed">174</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.175">
      <div class="step-ref passed">175</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">875</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.175">14:14:29.208 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 507
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102230268759719&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:29&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;QR&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102267472&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;QR-APP&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:30.077 response time in milliseconds: 867
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:21 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020355&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:22&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;QR&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102230268759719&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:29&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;9000&quot;,&quot;AddtlInf&quot;:&quot;El canal de origen de la transacciÃ³n enviado no es correcto.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.176">
      <div class="step-ref failed">176</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.176">14:14:30.079 classpath:Transferencia.feature:176
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:176
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.177">
      <div class="step-ref skipped">177</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.178">
      <div class="step-ref skipped">178</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;QR misma entidad&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[3:180]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[3:180]</span>
                <span class="scenario-name">Transferencia exitosa entre dos clientes de la misma entidad (ordenante CTA Corriente, receptor CTA Corriente)</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1640</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[3:180]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:30.108 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[3:180]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.181">
      <div class="step-ref passed">181</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ debtorAccountType: &#39;CTA_CORRIENTE&#39;, creditorAccountType: &#39;CTA_CORRIENTE&#39; })</span>
      </div>
    </div>
    <div class="time-cell passed">11</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.182">
      <div class="step-ref passed">182</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.183">
      <div class="step-ref passed">183</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.184">
      <div class="step-ref passed">184</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.185">
      <div class="step-ref passed">185</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.186">
      <div class="step-ref passed">186</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1611</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.186">14:14:30.149 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 509
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102276025926486&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:30&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102265146&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:31.749 response time in milliseconds: 1600
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:22 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020356&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:23&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102276025926486&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:30&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;6005&quot;,&quot;AddtlInf&quot;:&quot;Ambos IBAN son iguales.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.187">
      <div class="step-ref failed">187</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.187">14:14:31.757 classpath:Transferencia.feature:187
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:187
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.188">
      <div class="step-ref skipped">188</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.189">
      <div class="step-ref skipped">189</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Corriente vs Corriente misma entidad&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[4:191]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[4:191]</span>
                <span class="scenario-name">Transferencia exitosa entre dos clientes de diferentes entidades (ordenante local CTA Corriente, receptor intraredes CTA Corriente)</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>2015</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[4:191]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:31.781 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[4:191]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.192">
      <div class="step-ref passed">192</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ debtorAccountType: &#39;CTA_CORRIENTE&#39;, creditorAccountType: &#39;CTA_CORRIENTE&#39;, creditorEntity: &#39;0303&#39; })</span>
      </div>
    </div>
    <div class="time-cell passed">8</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.193">
      <div class="step-ref passed">193</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.194">
      <div class="step-ref passed">194</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.195">
      <div class="step-ref passed">195</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.196">
      <div class="step-ref passed">196</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.197">
      <div class="step-ref passed">197</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1991</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.197">14:14:31.819 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 509
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102254033468134&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:31&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0303&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102286479&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0403031000000000030101002222&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:33.807 response time in milliseconds: 1983
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:26 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020357&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:25&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0303&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102254033468134&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:31&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AB09&quot;,&quot;AddtlInf&quot;:&quot;No se encontrÃ³ la Entidad Financiera receptora.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.198">
      <div class="step-ref failed">198</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.198">14:14:33.807 classpath:Transferencia.feature:198
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:198
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.199">
      <div class="step-ref skipped">199</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.200">
      <div class="step-ref skipped">200</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Inter-IFI Corriente&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[5:202]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[5:202]</span>
                <span class="scenario-name">Transferencia no exitosa, el codigo IBAN es el mismo del ordenante y receptor</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1748</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[5:202]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:33.835 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[5:202]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.203">
      <div class="step-ref passed">203</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ sameIban: true })</span>
      </div>
    </div>
    <div class="time-cell passed">9</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.204">
      <div class="step-ref passed">204</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [400, 409, 422], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.205">
      <div class="step-ref passed">205</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">44</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.206">
      <div class="step-ref passed">206</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.207">
      <div class="step-ref passed">207</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.208">
      <div class="step-ref passed">208</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1680</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.208">14:14:33.912 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 509
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102257623160483&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:33&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102284731&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:35.590 response time in milliseconds: 1676
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:26 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020358&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:27&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102257623160483&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:33&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;6005&quot;,&quot;AddtlInf&quot;:&quot;Ambos IBAN son iguales.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.209">
      <div class="step-ref failed">209</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.209">14:14:35.590 classpath:Transferencia.feature:209
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:209
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.210">
      <div class="step-ref skipped">210</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.211">
      <div class="step-ref skipped">211</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Fallo por IBAN duplicado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[6:213]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[6:213]</span>
                <span class="scenario-name">Transferencia no exitosa, el codigo EndToEnd es el mismo del ordenante y receptor</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>3599</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[6:213]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:35.612 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[6:213]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.214">
      <div class="step-ref passed">214</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payloadInicial = buildPayload()</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.215">
      <div class="step-ref passed">215</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def successExpectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payloadInicial.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.216">
      <div class="step-ref passed">216</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def statusOk = normalizeStatus(successExpectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.217">
      <div class="step-ref passed">217</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.218">
      <div class="step-ref passed">218</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payloadInicial</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.219">
      <div class="step-ref passed">219</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">3582</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.219">14:14:35.640 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 509
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102238008759834&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:35&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102244963&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:39.215 response time in milliseconds: 3369
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:14:31 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020359&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:28&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102238008759834&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:35&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102244963&quot;,&quot;TxId&quot;:&quot;18536&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141430140139&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141430608155&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.220">
      <div class="step-ref failed">220</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in statusOk</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.220">14:14:39.215 classpath:Transferencia.feature:220
Then match responseStatus in statusOk
no step-definition method match found for: match responseStatus in statusOk
classpath:Transferencia.feature:220
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.221">
      <div class="step-ref skipped">221</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, successExpectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.222">
      <div class="step-ref skipped">222</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;EndToEnd base&#39;, payloadInicial, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.223">
      <div class="step-ref skipped">223</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def duplicateEndToEnd = payloadInicial.CdtTrfTxInf.PmtId.EndToEndId</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.224">
      <div class="step-ref skipped">224</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def payloadDuplicado = buildPayload({ endToEndId: duplicateEndToEnd })</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.225">
      <div class="step-ref skipped">225</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [409, 400], outcome: &#39;reject&#39;, expectedEndToEndId: duplicateEndToEnd }</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.226">
      <div class="step-ref skipped">226</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.227">
      <div class="step-ref skipped">227</div>
      
      <div class="step-cell skipped">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.228">
      <div class="step-ref skipped">228</div>
      
      <div class="step-cell skipped">
        <span>And</span>&nbsp;<span>request payloadDuplicado</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.229">
      <div class="step-ref skipped">229</div>
      
      <div class="step-cell skipped">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.230">
      <div class="step-ref skipped">230</div>
      
      <div class="step-cell skipped">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.231">
      <div class="step-ref skipped">231</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.232">
      <div class="step-ref skipped">232</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Fallo por EndToEnd repetido&#39;, payloadDuplicado, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[7:234]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[7:234]</span>
                <span class="scenario-name">Transferencia no exitosa, el codigo MsgId es el mismo del ordenante y receptor</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>3499</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[7:234]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:39.238 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[7:234]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.235">
      <div class="step-ref passed">235</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payloadBase = buildPayload()</span>
      </div>
    </div>
    <div class="time-cell passed">8</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.236">
      <div class="step-ref passed">236</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def okExpectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedMsgId: payloadBase.GrpHdr.msgId }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.237">
      <div class="step-ref passed">237</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def okStatus = normalizeStatus(okExpectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.238">
      <div class="step-ref passed">238</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.239">
      <div class="step-ref passed">239</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payloadBase</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.240">
      <div class="step-ref passed">240</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">3477</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.240">14:14:39.264 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 509
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102257438954004&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:39&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102294747&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:42.738 response time in milliseconds: 3387
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:14:33 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020360&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:32&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102257438954004&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:39&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102294747&quot;,&quot;TxId&quot;:&quot;18537&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141433526306&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141433964146&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.241">
      <div class="step-ref failed">241</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in okStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.241">14:14:42.738 classpath:Transferencia.feature:241
Then match responseStatus in okStatus
no step-definition method match found for: match responseStatus in okStatus
classpath:Transferencia.feature:241
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.242">
      <div class="step-ref skipped">242</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, okExpectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.243">
      <div class="step-ref skipped">243</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;MsgId base&#39;, payloadBase, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.244">
      <div class="step-ref skipped">244</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def duplicateMsgId = payloadBase.GrpHdr.msgId</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.245">
      <div class="step-ref skipped">245</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def payloadRepetido = buildPayload({ msgId: duplicateMsgId })</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.246">
      <div class="step-ref skipped">246</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [409, 400], outcome: &#39;reject&#39;, expectedMsgId: duplicateMsgId }</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.247">
      <div class="step-ref skipped">247</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.248">
      <div class="step-ref skipped">248</div>
      
      <div class="step-cell skipped">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.249">
      <div class="step-ref skipped">249</div>
      
      <div class="step-cell skipped">
        <span>And</span>&nbsp;<span>request payloadRepetido</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.250">
      <div class="step-ref skipped">250</div>
      
      <div class="step-cell skipped">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.251">
      <div class="step-ref skipped">251</div>
      
      <div class="step-cell skipped">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.252">
      <div class="step-ref skipped">252</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.253">
      <div class="step-ref skipped">253</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Fallo por MsgId repetido&#39;, payloadRepetido, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[8:255]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[8:255]</span>
                <span class="scenario-name">Transferencia no exitosa, numero de transacciones diarias superior al permitido</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>799</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[8:255]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:42.762 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[8:255]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.256">
      <div class="step-ref passed">256</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ nbOfTxs: 999 })</span>
      </div>
    </div>
    <div class="time-cell passed">10</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.257">
      <div class="step-ref passed">257</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [429, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.258">
      <div class="step-ref passed">258</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.259">
      <div class="step-ref passed">259</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.260">
      <div class="step-ref passed">260</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.261">
      <div class="step-ref passed">261</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">776</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.261">14:14:42.788 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 511
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102222274573787&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:42&quot;,&quot;nbOfTxs&quot;:999,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102274850&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:43.567 response time in milliseconds: 775
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:36 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020361&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:35&quot;,&quot;NbOfTxs&quot;:999,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102222274573787&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:42&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;9000&quot;,&quot;AddtlInf&quot;:&quot;El nÃºmero de transacciones (NbOfTxs) es requerida. Tiene que enviar por lo menos 1 en el nÃºmero de transacciones.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.262">
      <div class="step-ref failed">262</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.262">14:14:43.567 classpath:Transferencia.feature:262
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:262
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.263">
      <div class="step-ref skipped">263</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.264">
      <div class="step-ref skipped">264</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Exceso de transacciones diarias&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[9:266]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[9:266]</span>
                <span class="scenario-name">Transferencia no exitosa, monto maximo con decimales por transaccion</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1765</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[9:266]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:43.591 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[9:266]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.267">
      <div class="step-ref passed">267</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 15000.75 })</span>
      </div>
    </div>
    <div class="time-cell passed">13</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.268">
      <div class="step-ref passed">268</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [422, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.269">
      <div class="step-ref passed">269</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.270">
      <div class="step-ref passed">270</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.271">
      <div class="step-ref passed">271</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.272">
      <div class="step-ref passed">272</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1741</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.272">14:14:43.624 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 516
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102231912219681&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:43&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102299017&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:15000.75,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:45.357 response time in milliseconds: 1733
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:36 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020362&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:36&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102231912219681&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:43&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.273">
      <div class="step-ref failed">273</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.273">14:14:45.365 classpath:Transferencia.feature:273
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:273
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.274">
      <div class="step-ref skipped">274</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.275">
      <div class="step-ref skipped">275</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Monto decimal supera limite&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[10:277]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[10:277]</span>
                <span class="scenario-name">Transferencia no exitosa, monto maximo entero por transaccion</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1999</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[10:277]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:45.382 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[10:277]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.278">
      <div class="step-ref passed">278</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 20000 })</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.279">
      <div class="step-ref passed">279</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [422, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.280">
      <div class="step-ref passed">280</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.281">
      <div class="step-ref passed">281</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.282">
      <div class="step-ref passed">282</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.283">
      <div class="step-ref passed">283</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1983</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.283">14:14:45.406 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 515
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102291567638368&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:45&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102200102&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:20000.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:47.389 response time in milliseconds: 1980
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:39 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020363&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:38&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102291567638368&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:45&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.284">
      <div class="step-ref failed">284</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.284">14:14:47.391 classpath:Transferencia.feature:284
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:284
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.285">
      <div class="step-ref skipped">285</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.286">
      <div class="step-ref skipped">286</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Monto entero supera limite&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[11:288]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[11:288]</span>
                <span class="scenario-name">Transferencia no exitosa, monto minimo con valor decimal de 2.99</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>3421</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[11:288]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:47.411 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[11:288]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.289">
      <div class="step-ref passed">289</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 2.99 })</span>
      </div>
    </div>
    <div class="time-cell passed">9</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.290">
      <div class="step-ref passed">290</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [422, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.291">
      <div class="step-ref passed">291</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.292">
      <div class="step-ref passed">292</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.293">
      <div class="step-ref passed">293</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.294">
      <div class="step-ref passed">294</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">3398</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.294">14:14:47.443 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 512
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102232799996672&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:47&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102212553&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:2.99,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:50.837 response time in milliseconds: 3303
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:14:41 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020364&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:40&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102232799996672&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:47&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102212553&quot;,&quot;TxId&quot;:&quot;18538&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141441901586&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141442354279&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.295">
      <div class="step-ref failed">295</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.295">14:14:50.839 classpath:Transferencia.feature:295
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:295
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.296">
      <div class="step-ref skipped">296</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.297">
      <div class="step-ref skipped">297</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Monto decimal inferior al minimo&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[12:299]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[12:299]</span>
                <span class="scenario-name">Transferencia no exitosa, monto minimo entero de 1.00</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>3656</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[12:299]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:50.861 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[12:299]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.300">
      <div class="step-ref passed">300</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 1.00 })</span>
      </div>
    </div>
    <div class="time-cell passed">8</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.301">
      <div class="step-ref passed">301</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [422, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.302">
      <div class="step-ref passed">302</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.303">
      <div class="step-ref passed">303</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.304">
      <div class="step-ref passed">304</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.305">
      <div class="step-ref passed">305</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">3638</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.305">14:14:50.889 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 511
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102285189261842&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:50&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102202407&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:54.523 response time in milliseconds: 3538
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:14:46 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020365&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:44&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102285189261842&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:50&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102202407&quot;,&quot;TxId&quot;:&quot;18539&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141445452947&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141445890318&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.306">
      <div class="step-ref failed">306</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.306">14:14:54.523 classpath:Transferencia.feature:306
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:306
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.307">
      <div class="step-ref skipped">307</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.308">
      <div class="step-ref skipped">308</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Monto entero inferior al minimo&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[13:310]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[13:310]</span>
                <span class="scenario-name">Transferencia no exitosa, monto 0.00</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1699</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[13:310]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:54.545 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[13:310]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.311">
      <div class="step-ref passed">311</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 0.00 })</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.312">
      <div class="step-ref passed">312</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [422, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.313">
      <div class="step-ref passed">313</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.314">
      <div class="step-ref passed">314</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.315">
      <div class="step-ref passed">315</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.316">
      <div class="step-ref passed">316</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1662</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.316">14:14:54.592 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 511
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102253059527838&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:54&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102207607&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:0.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:56.248 response time in milliseconds: 1656
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:47 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020366&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:47&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102253059527838&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:54&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM06&quot;,&quot;AddtlInf&quot;:&quot;El monto no cumple con el mÃ­nimo requerido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.317">
      <div class="step-ref failed">317</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.317">14:14:56.248 classpath:Transferencia.feature:317
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:317
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.318">
      <div class="step-ref skipped">318</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.319">
      <div class="step-ref skipped">319</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Monto cero&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[14:321]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[14:321]</span>
                <span class="scenario-name">Validar limites por transacciones de usuario, monto acumulado diario superior al permitido</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1833</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[14:321]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">7</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:56.274 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[14:321]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.322">
      <div class="step-ref passed">322</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 5000.00 })</span>
      </div>
    </div>
    <div class="time-cell passed">13</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.323">
      <div class="step-ref passed">323</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [429, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.324">
      <div class="step-ref passed">324</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.325">
      <div class="step-ref passed">325</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.326">
      <div class="step-ref passed">326</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.327">
      <div class="step-ref passed">327</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1798</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.327">14:14:56.320 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 514
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102286051865074&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:56&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102249135&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:5000.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:14:58.111 response time in milliseconds: 1791
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:50 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020367&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:49&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102286051865074&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:56&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.328">
      <div class="step-ref failed">328</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.328">14:14:58.111 classpath:Transferencia.feature:328
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:328
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.329">
      <div class="step-ref skipped">329</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.330">
      <div class="step-ref skipped">330</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Limite diario acumulado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[15:332]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[15:332]</span>
                <span class="scenario-name">Validar limites por transacciones de usuario, monto acumulado mensual superior al permitido</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1922</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[15:332]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:14:58.136 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[15:332]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.333">
      <div class="step-ref passed">333</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 12000.00 })</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.334">
      <div class="step-ref passed">334</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [429, 409, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.335">
      <div class="step-ref passed">335</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.336">
      <div class="step-ref passed">336</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.337">
      <div class="step-ref passed">337</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.338">
      <div class="step-ref passed">338</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1902</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.338">14:14:58.160 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 515
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102217544221669&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:14:58&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102228612&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:12000.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:00.060 response time in milliseconds: 1897
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:51 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020368&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:51&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102217544221669&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:14:58&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.339">
      <div class="step-ref failed">339</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.339">14:15:00.060 classpath:Transferencia.feature:339
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:339
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.340">
      <div class="step-ref skipped">340</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.341">
      <div class="step-ref skipped">341</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Limite mensual acumulado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[16:343]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[16:343]</span>
                <span class="scenario-name">Transferencia exitosa, monto total diario permitido despues de modificar el parametro</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>2457</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[16:343]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:00.081 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[16:343]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.344">
      <div class="step-ref passed">344</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Asegurar que el parametro de limite diario haya sido actualizado antes de ejecutar este escenario.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.344">14:15:00.091 Asegurar que el parametro de limite diario haya sido actualizado antes de ejecutar este escenario. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.345">
      <div class="step-ref passed">345</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 3000.00 })</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.346">
      <div class="step-ref passed">346</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.347">
      <div class="step-ref passed">347</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.348">
      <div class="step-ref passed">348</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.349">
      <div class="step-ref passed">349</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.350">
      <div class="step-ref passed">350</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">2439</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.350">14:15:00.105 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 514
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102296620949532&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:00&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102241597&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:3000.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:02.541 response time in milliseconds: 2431
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:54 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020369&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:53&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102296620949532&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:00&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.351">
      <div class="step-ref failed">351</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.351">14:15:02.543 classpath:Transferencia.feature:351
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:351
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.352">
      <div class="step-ref skipped">352</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.353">
      <div class="step-ref skipped">353</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Exito limite diario actualizado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[17:355]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[17:355]</span>
                <span class="scenario-name">Transferencia exitosa, monto total mensual permitido despues de modificar el parametro</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1588</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[17:355]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:02.559 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[17:355]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.356">
      <div class="step-ref passed">356</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Asegurar que el parametro de limite mensual haya sido actualizado antes de ejecutar este escenario.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.356">14:15:02.577 Asegurar que el parametro de limite mensual haya sido actualizado antes de ejecutar este escenario. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.357">
      <div class="step-ref passed">357</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 15000.00 })</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.358">
      <div class="step-ref passed">358</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.359">
      <div class="step-ref passed">359</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.360">
      <div class="step-ref passed">360</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.361">
      <div class="step-ref passed">361</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.362">
      <div class="step-ref passed">362</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1570</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.362">14:15:02.587 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 515
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102245431330268&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:02&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102273504&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:15000.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QA22&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:04.152 response time in milliseconds: 1565
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:55 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020370&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:56&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102245431330268&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:02&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.363">
      <div class="step-ref failed">363</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.363">14:15:04.155 classpath:Transferencia.feature:363
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:363
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.364">
      <div class="step-ref skipped">364</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.365">
      <div class="step-ref skipped">365</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Exito limite mensual actualizado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[18:367]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[18:367]</span>
                <span class="scenario-name">Transferencia no exitosa, fondos insuficientes</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>2232</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[18:367]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:04.171 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[18:367]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.368">
      <div class="step-ref passed">368</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ amount: 7500.00, prtryOverrides: { CustRef: &#39;FONDOS_INSUF&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">29</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.369">
      <div class="step-ref passed">369</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [409, 402, 400], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.370">
      <div class="step-ref passed">370</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.371">
      <div class="step-ref passed">371</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.372">
      <div class="step-ref passed">372</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.373">
      <div class="step-ref passed">373</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">2190</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.373">14:15:04.225 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 522
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102278671249079&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:04&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102207042&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:7500.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;FONDOS_INSUF&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:06.408 response time in milliseconds: 2183
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:14:58 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020371&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:14:57&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102278671249079&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:04&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;AM02&quot;,&quot;AddtlInf&quot;:&quot;El monto excede el mÃ¡ximo permitido.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.374">
      <div class="step-ref failed">374</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.374">14:15:06.408 classpath:Transferencia.feature:374
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:374
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.375">
      <div class="step-ref skipped">375</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.376">
      <div class="step-ref skipped">376</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Fondos insuficientes&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[19:378]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[19:378]</span>
                <span class="scenario-name">Transferencia no exitosa, cuenta ordenante bloqueada en el directorio</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>4173</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[19:378]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:06.428 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[19:378]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.379">
      <div class="step-ref passed">379</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Preparar la cuenta ordenante en estado BLOQUEADO antes de la prueba.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.379">14:15:06.442 Preparar la cuenta ordenante en estado BLOQUEADO antes de la prueba. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.380">
      <div class="step-ref passed">380</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ debtorAccountType: &#39;CTA_AHORROS&#39;, prtryOverrides: { CustRef: &#39;LOCKED-ORD&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">7</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.381">
      <div class="step-ref passed">381</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [423, 409, 403], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.382">
      <div class="step-ref passed">382</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.383">
      <div class="step-ref passed">383</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.384">
      <div class="step-ref passed">384</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.385">
      <div class="step-ref passed">385</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">4154</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.385">14:15:06.456 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 517
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102295333963656&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:06&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102214975&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;LOCKED-ORD&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:10.604 response time in milliseconds: 4048
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:15:01 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020372&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:15:00&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102295333963656&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:06&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102214975&quot;,&quot;TxId&quot;:&quot;18540&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141501016931&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141501453772&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.386">
      <div class="step-ref failed">386</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.386">14:15:10.605 classpath:Transferencia.feature:386
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:386
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.387">
      <div class="step-ref skipped">387</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.388">
      <div class="step-ref skipped">388</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Ordenante bloqueado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[20:390]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[20:390]</span>
                <span class="scenario-name">Transferencia exitosa, cuenta ordenante desbloqueada en el directorio</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>4778</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[20:390]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:10.625 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[20:390]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.391">
      <div class="step-ref passed">391</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Asegurar que la cuenta ordenante esta DESBLOQUEADA antes de la prueba.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.391">14:15:10.638 Asegurar que la cuenta ordenante esta DESBLOQUEADA antes de la prueba. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.392">
      <div class="step-ref passed">392</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ debtorAccountType: &#39;CTA_AHORROS&#39;, prtryOverrides: { CustRef: &#39;UNLOCK-ORD&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">7</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.393">
      <div class="step-ref passed">393</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.394">
      <div class="step-ref passed">394</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.395">
      <div class="step-ref passed">395</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.396">
      <div class="step-ref passed">396</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.397">
      <div class="step-ref passed">397</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">4759</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.397">14:15:10.653 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 517
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102215092595510&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:10&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102238936&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;UNLOCK-ORD&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:15.405 response time in milliseconds: 4664
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:15:07 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020373&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:15:04&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102215092595510&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:10&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102238936&quot;,&quot;TxId&quot;:&quot;18541&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141506141419&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141506610434&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.398">
      <div class="step-ref failed">398</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.398">14:15:15.405 classpath:Transferencia.feature:398
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:398
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.399">
      <div class="step-ref skipped">399</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.400">
      <div class="step-ref skipped">400</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Ordenante desbloqueado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[21:402]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[21:402]</span>
                <span class="scenario-name">Transferencia no exitosa mediante QR, cuenta receptora desafiliada en el directorio</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>1953</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[21:402]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:15.430 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[21:402]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.403">
      <div class="step-ref passed">403</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Configurar la cuenta receptora como DESAFILIADA antes de la prueba.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.403">14:15:15.441 Configurar la cuenta receptora como DESAFILIADA antes de la prueba. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.404">
      <div class="step-ref passed">404</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ channel: &#39;QR&#39;, creditorAccountType: &#39;CTA_CORRIENTE&#39;, prtryOverrides: { CustRef: &#39;QR-DESAF&#39;, ChanRef: &#39;QR-DESA&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">6</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.405">
      <div class="step-ref passed">405</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [404, 409, 403], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.406">
      <div class="step-ref passed">406</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.407">
      <div class="step-ref passed">407</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.408">
      <div class="step-ref passed">408</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.409">
      <div class="step-ref passed">409</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">1935</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.409">14:15:15.454 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 514
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102282355753137&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:15&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;QR&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102271721&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;QR-DESAF&quot;,&quot;ChanRef&quot;:&quot;QR-DESA&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:17.385 response time in milliseconds: 1928
1 &lt; 400
1 &lt; Date: Wed, 22 Oct 2025 19:15:08 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020374&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:15:08&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;QR&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102282355753137&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:15&quot;},&quot;TxSts&quot;:&quot;ERR&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;9000&quot;,&quot;AddtlInf&quot;:&quot;El canal de origen de la transacciÃ³n enviado no es correcto.&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.410">
      <div class="step-ref failed">410</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.410">14:15:17.388 classpath:Transferencia.feature:410
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:410
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.411">
      <div class="step-ref skipped">411</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.412">
      <div class="step-ref skipped">412</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Receptor desafiliado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[22:414]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[22:414]</span>
                <span class="scenario-name">Transferencia no exitosa, cuenta receptora bloqueada en el directorio</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>5238</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[22:414]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:17.405 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[22:414]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.415">
      <div class="step-ref passed">415</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Configurar la cuenta receptora en estado BLOQUEADO antes de la prueba.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.415">14:15:17.416 Configurar la cuenta receptora en estado BLOQUEADO antes de la prueba. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.416">
      <div class="step-ref passed">416</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ creditorAccountType: &#39;CTA_CORRIENTE&#39;, prtryOverrides: { CustRef: &#39;LOCKED-REC&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">7</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.417">
      <div class="step-ref passed">417</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [423, 409, 403], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.418">
      <div class="step-ref passed">418</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.419">
      <div class="step-ref passed">419</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.420">
      <div class="step-ref passed">420</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.421">
      <div class="step-ref passed">421</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">5220</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.421">14:15:17.429 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 517
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102234215767818&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:17&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102227331&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;LOCKED-REC&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:22.644 response time in milliseconds: 5120
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:15:14 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020375&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:15:11&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102234215767818&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:17&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102227331&quot;,&quot;TxId&quot;:&quot;18542&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141513626737&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141514063107&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.422">
      <div class="step-ref failed">422</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.422">14:15:22.644 classpath:Transferencia.feature:422
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:422
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.423">
      <div class="step-ref skipped">423</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.424">
      <div class="step-ref skipped">424</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Receptor bloqueado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[23:426]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[23:426]</span>
                <span class="scenario-name">Transferencia exitosa, cuenta receptora desbloqueada en el directorio</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>3476</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[23:426]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:22.665 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[23:426]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.427">
      <div class="step-ref passed">427</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Asegurar que la cuenta receptora esta DESBLOQUEADA antes de la prueba.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.427">14:15:22.680 Asegurar que la cuenta receptora esta DESBLOQUEADA antes de la prueba. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.428">
      <div class="step-ref passed">428</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ creditorAccountType: &#39;CTA_CORRIENTE&#39;, prtryOverrides: { CustRef: &#39;UNLOCK-REC&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.429">
      <div class="step-ref passed">429</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: 200, outcome: &#39;success&#39;, expectedEndToEndId: payload.CdtTrfTxInf.PmtId.EndToEndId }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.430">
      <div class="step-ref passed">430</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.431">
      <div class="step-ref passed">431</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.432">
      <div class="step-ref passed">432</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.433">
      <div class="step-ref passed">433</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">3461</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.433">14:15:22.687 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 517
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102235748785005&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:22&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102272793&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;UNLOCK-REC&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:26.146 response time in milliseconds: 3368
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:15:17 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020376&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:15:16&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102235748785005&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:22&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102272793&quot;,&quot;TxId&quot;:&quot;18543&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141517206950&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141517652321&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.434">
      <div class="step-ref failed">434</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.434">14:15:26.146 classpath:Transferencia.feature:434
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:434
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.435">
      <div class="step-ref skipped">435</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.436">
      <div class="step-ref skipped">436</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Receptor desbloqueado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[24:438]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[24:438]</span>
                <span class="scenario-name">Transferencia no exitosa, debito aplicado y switch detenido</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>3888</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[24:438]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:26.170 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">2</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[24:438]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.439">
      <div class="step-ref passed">439</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>eval karate.log(&#39;Simular caida del switch despues del debito para validar reverso.&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.439">14:15:26.192 Simular caida del switch despues del debito para validar reverso. 
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.440">
      <div class="step-ref passed">440</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def payload = buildPayload({ prtryOverrides: { CustRef: &#39;SWITCH-DOWN&#39; } })</span>
      </div>
    </div>
    <div class="time-cell passed">5</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.441">
      <div class="step-ref passed">441</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [502, 500, 409], outcome: &#39;pending&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.442">
      <div class="step-ref passed">442</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell passed">3</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.443">
      <div class="step-ref passed">443</div>
      
      <div class="step-cell passed">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.444">
      <div class="step-ref passed">444</div>
      
      <div class="step-cell passed">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.445">
      <div class="step-ref passed">445</div>
      
      <div class="step-cell passed">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell passed">3858</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.445">14:15:26.206 request:
1 &gt; POST https://apipanapayqa.coonecta.com.ec/api/switchcentral/finan/transferencia
1 &gt; Content-Type: application/json; charset=UTF-8
1 &gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI2dUJWTkN6VlViUFBlTFdReEM0WDAyYVM3UnM2UGRYV1dja1dfc0xZMHlFIn0.eyJleHAiOjE3NjExNjA3NTAsImlhdCI6MTc2MTE2MDQ1MCwianRpIjoidHJydGNjOjQ5Yjg0NDVjLTgzYTAtMjI4Ni02NDczLWE2ZGEzOTBhOWQ0YSIsImlzcyI6Imh0dHBzOi8vYXV0ZW50aWNhY2lvbnFhLmNvb25lY3RhLmNvbS5lYy9hdXRoL3JlYWxtcy9QQU5BUEFZIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6Ijk5OGMyZmUwLTJjOGYtNGQwNC1iZjExLWY1OWExZTM5ODg3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6IjAyMDVjYiIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtYWRtaW5wYW5hcGF5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7IjAyMDVjYiI6eyJyb2xlcyI6WyJ1bWFfcHJvdGVjdGlvbiJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjbGllbnRIb3N0IjoiMTAuMTAuMTAuMTUxIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LTAyMDVjYiIsImNsaWVudEFkZHJlc3MiOiIxMC4xMC4xMC4xNTEiLCJjbGllbnRfaWQiOiIwMjA1Y2IifQ.bATUogohrEqy7Voa4mFnsBzOnGy6tnjZGh_lOYRn-0hWXMY_fz-280nTu2Vv68eO3HeoewtWlt45S_iLI2-ml3pqpAlt3DXWVmLvVHw6d7TICHBfQsa0jGXMexKnyar7EinrVhF3deSK25Ap_ajC_82EvVvXrVG-7p9F1dEdq39y2R72JympejF5uhY_z_jNmqJSsnLEZVOo3WMJn76u9tTcYVIldC5uWGFWbPGEhvWPx4ZGpsuq_wrPOGdRmyJDFJPJl7LnLGHK0DBhuVtJUq_NFQkMus2fTTf_mWhRnoqNU-wUCS-fxMs6QusGzIVd-C3O29J3rerHTrGg21LAsQ
1 &gt; Content-Length: 518
1 &gt; Host: apipanapayqa.coonecta.com.ec
1 &gt; Connection: Keep-Alive
1 &gt; User-Agent: Apache-HttpClient/4.5.14 (Java/17.0.12)
1 &gt; Accept-Encoding: gzip,deflate
{&quot;GrpHdr&quot;:{&quot;msgId&quot;:&quot;02052025102251904687427&quot;,&quot;creDtTm&quot;:&quot;2025-10-22T14:15:26&quot;,&quot;nbOfTxs&quot;:1,&quot;sttlmInf&quot;:{&quot;sttlmMtd&quot;:&quot;INGA&quot;},&quot;instgAgt&quot;:{&quot;finInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.321.01&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102246781&quot;},&quot;IntrBkSttlmAmt&quot;:{&quot;Amt&quot;:1.0,&quot;Ccy&quot;:&quot;USD&quot;},&quot;DbtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC5002051000000000020501052673&quot;},&quot;CdtrAcctId&quot;:{&quot;IBAN&quot;:&quot;EC0402051000000000020101002318&quot;},&quot;Prtry&quot;:{&quot;CustRef&quot;:&quot;SWITCH-DOWN&quot;,&quot;ChanRef&quot;:&quot;TERM001&quot;,&quot;AgtRef&quot;:&quot;AGT0002&quot;}}}

14:15:30.063 response time in milliseconds: 3763
1 &lt; 200
1 &lt; Date: Wed, 22 Oct 2025 19:15:22 GMT
1 &lt; Content-Type: application/json; charset=utf-8
1 &lt; Transfer-Encoding: chunked
1 &lt; Connection: keep-alive
1 &lt; Server: Kestrel
1 &lt; Set-Cookie: ARRAffinity=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Set-Cookie: ARRAffinitySameSite=135f536e0d078a815c3b83fda3468ab8a3a2abc604a35eefb28648d3961cfa9b;Path=/;HttpOnly;SameSite=None;Secure;Domain=app-apipanapay-qa.azurewebsites.net
1 &lt; Vary: Accept-Encoding
1 &lt; Request-Context: appId=cid-v1:a7a77847-2713-450f-9030-b350a2d54a28
1 &lt; X-Powered-By: ASP.NET
1 &lt; X-ARR-ClientCert: -----BEGIN%20CERTIFICATE-----%0AMIIEHDCCAgSgAwIBAgIUZIZBO0fb7VZ4KXrs01S4RYbWyJ8wDQYJKoZIhvcNAQEL%0ABQAwJTEjMCEGA1UEAwwacm9vdGNlcnQuY2JpYmxpYW4uaW50ZXJuYWwwHhcNMjUw%0AODEzMTMyNTU5WhcNMjgwODEyMTMyNTU5WjAnMSUwIwYDVQQDDBxjbGllbnRjZXJ0%0ALmNiaWJsaWFuLmludGVybmFsMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC%0AAQEAskUDap6NmyYq8RT6F7z3DpZGQiflNQTvUT84TmxsKXEBRAkgINnkJqgKkd7f%0ASEybzqglQTbr4s41lCiPsy3X66qYjU2L%2Bojhni%2BOCVOX7n3JBYovL%2FqfMP3%2FkhZP%0AQIlK%2FQWPcrnl39fYkGOQv%2BYqoCGEPzGkib2m1Ma5Q1HOCKh1ErMjqTLGy%2ByJj6JY%0AiZvMx3YrJSvjUS0uKpNwxPtGyiexRfKsmR%2FHqPzRHa0iY%2B752KSgUedwJPv1Wod%2B%0AY9BMAMIdU25UtkUEsaOYtorGWDaZSn2Bl0LYmP87kjcYypnHx0jtPtUCXfVHrE6u%0AZnDRFYsZbeXylY3mJkyOL2DzZwIDAQABo0IwQDAdBgNVHQ4EFgQURPhJwTAcUWUp%0ArOqQO68P%2FbJoqjMwHwYDVR0jBBgwFoAU7GdlxoSeEXucEXhjadHRC9xzS0UwDQYJ%0AKoZIhvcNAQELBQADggIBAGTnlyF2n%2F6s9phYbO8V17niO0BXB62ToX6gPhcw9f3y%0AhMui6RnrM1oiHlBWqZquCqYJ5ETvYJE1RqvoqtGysxCnIj0OTJHV4WtF3SHsd1Tu%0ATg%2B%2FUnGivtBTDQxj9sbAtCaSYRBqPByP8jvSTDgXR1mgOrEGjr2PZdZSoKLj4OHi%0A9UCMJw7pJsyA4lbroKshQTYv5Ks5SqtJpdp0%2BUX0UUlbPJqXiadfbKdoXvEgcwbP%0ACqR9v7kGYmNxfaGLNGVrV%2BnLawIDmdYXJE%2F4WJh6sHfiZxEsE%2BB4PoKADrb1Eapt%0AnSdHUgRfc0i5f2lcmErnU8nCMO5TWdHFOgpYwTS8w17FhNFZpaSmyZKM7uHcUs7y%0AUbuiQtdXocfSSMf%2FeycBEU%2FHAVIWQEqY%2BbJdC0q%2FR%2BsESeBtXd4IEIxR0QfgscGk%0AJyCSFC8z%2FvCgrRsH5rePqKO7%2FLAsDTP4GIQNFNfF4Wh6bsPXuJmvvoMcnmy%2F58Wo%0AE0XaG8UPHVAeyEmhncdM32E7SJbR91aRr2CkV23OoUz%2BwKG2%2FuObHmAkuMkCbbcz%0AJQoC7DZg5FGw%2BZR7v1DIBct5QNJQ8bG%2FXGRxjWC6dU7jrGhOF1X%2B2YYcdx9XnwyM%0A9YPxUy5bVfMhIiKP2wEso5fjOZ4RTvnB5R6zD3maJK%2FtZAXVhtyqXSkBYFi4MvEs%0A-----END%20CERTIFICATE-----%0A
{&quot;GrpHdr&quot;:{&quot;MsgId&quot;:&quot;000020251022020377&quot;,&quot;CreDtTm&quot;:&quot;2025-10-22T14:15:19&quot;,&quot;NbOfTxs&quot;:1,&quot;SttlmInf&quot;:{&quot;SttlmMtd&quot;:&quot;INGA&quot;},&quot;InstgAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;InstdAgt&quot;:{&quot;FinInstnId&quot;:&quot;0205&quot;},&quot;Mge&quot;:{&quot;Type&quot;:&quot;acmt.998.322.001&quot;},&quot;ChnlId&quot;:&quot;APP&quot;},&quot;CdtTrfTxInf&quot;:{&quot;OrgnGrpInf&quot;:{&quot;OrgnlMsgId&quot;:&quot;02052025102251904687427&quot;,&quot;OrgnlMgeType&quot;:&quot;acmt.998.321.01&quot;,&quot;OrgnlCreDtTm&quot;:&quot;2025-10-22T14:15:26&quot;},&quot;PmtId&quot;:{&quot;EndToEndId&quot;:&quot;02052025102246781&quot;,&quot;TxId&quot;:&quot;18544&quot;},&quot;TxSts&quot;:&quot;Ok&quot;,&quot;Rsn&quot;:{&quot;RsnCd&quot;:&quot;0000&quot;,&quot;AddtlInf&quot;:&quot;TransacciÃ³n Exitosa&quot;},&quot;Dbtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141520949713&quot;},&quot;Cdtr&quot;:{&quot;AuthCode&quot;:&quot;020520251022141521387553&quot;},&quot;SttlmDt&quot;:&quot;2025-10-22&quot;}}

</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.446">
      <div class="step-ref failed">446</div>
      
      <div class="step-cell failed">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell failed">0</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.446">14:15:30.063 classpath:Transferencia.feature:446
Then match responseStatus in normalizedStatus
no step-definition method match found for: match responseStatus in normalizedStatus
classpath:Transferencia.feature:446
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.447">
      <div class="step-ref skipped">447</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.448">
      <div class="step-ref skipped">448</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Switch detenido&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
        <div class="scenario">
          <div class="scenario-heading" id="[25:450]">
            <div class="heading-container">
              <div class="scenario-tags">
                <a class="badge badge-primary" href="karate-tags.html">transferencia</a>
              </div>
              <div class="scenario-keyword">
                Scenario: <span>[25:450]</span>
                <span class="scenario-name">Transferencia no exitosa, token caducado o expirado</span>
                <span></span>
              </div>
            </div>
            <div class="scenario-time failed">
              <span>ms:</span>&nbsp;<span>51</span>
            </div>
          </div>
          <div class="step-row">
            <div class="step-container" id="[25:450]bg">
              <div class="step-ref bg-step">&gt;&gt;</div>
              <div class="step-cell passed">Background:</div>
            </div>
            <div class="time-cell passed"></div>
          </div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.5">
      <div class="step-ref bg-step">5</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenContext = callonce read(&#39;classpath:helpers/generate-token.feature&#39;)</span>
      </div>
    </div>
    <div class="time-cell passed">4</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.5">14:15:30.088 key store key count for classpath:certificado/clientcert.cbiblian.internal 1.pfx: 1
</div>   

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.6">
      <div class="step-ref bg-step">6</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def tokenData = tokenContext.tokenInfo</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.7">
      <div class="step-ref bg-step">7</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def transferenciaBaseUrl = karate.properties[&#39;transfer.baseUrl&#39;] || &#39;https://apipanapayqa.coonecta.com.ec/api/switchcentral&#39;</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.8">
      <div class="step-ref bg-step">8</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>url transferenciaBaseUrl</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.9">
      <div class="step-ref bg-step">9</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def authHeaders = { &#39;Content-Type&#39;: &#39;application/json&#39; }</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.10">
      <div class="step-ref bg-step">10</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>set authHeaders.Authorization = &#39;Bearer &#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell passed">1</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.11">
      <div class="step-ref bg-step">11</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.12">
      <div class="step-ref bg-step">12</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def accountCatalog =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.12">{
  &quot;0205&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5002051000000000020501052673&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0402051000000000020101002318&quot;
  },
  &quot;0303&quot;: {
    &quot;CTA_AHORROS&quot;: &quot;EC5003031000000000030301051111&quot;,
    &quot;CTA_CORRIENTE&quot;: &quot;EC0403031000000000030101002222&quot;
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.25">
      <div class="step-ref bg-step">25</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def normalizeStatus =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.25">function(value){
  var list;
  if (!value &amp;&amp; value !== 0){
    list = [200];
  } else {
    list = Array.isArray(value) ? value.slice(0) : [value];
  }
  if (list.indexOf(200) === -1){
    list.push(200);
  }
  return list;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.40">
      <div class="step-ref bg-step">40</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def buildPayload =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.40">function(overrides){
  overrides = overrides || {};
  var token = karate.get(&#39;tokenData&#39;);
  var catalog = karate.get(&#39;accountCatalog&#39;);
  var LocalDateTime = Java.type(&#39;java.time.LocalDateTime&#39;);
  var DateTimeFormatter = Java.type(&#39;java.time.format.DateTimeFormatter&#39;);
  var timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;));
  var randomDigits = function(length){
    var digits = &#39;&#39;;
    for (var i = 0; i &lt; length; i++){
      digits += Math.floor(Math.random() * 10);
    }
    return digits;
  };
  var coopCode = overrides.instgAgtFinInstId || token.coop_codecb || &#39;0205&#39;;
  var debtorType = overrides.debtorAccountType || &#39;CTA_AHORROS&#39;;
  var creditorType = overrides.creditorAccountType || &#39;CTA_CORRIENTE&#39;;
  var creditorEntity = overrides.creditorEntity || overrides.instdAgtFinInstId || coopCode;
  var debtorAccounts = catalog[coopCode] || catalog[&#39;0205&#39;];
  var creditorAccounts = catalog[creditorEntity] || catalog[&#39;0303&#39;];
  var debtorIban = overrides.debtorIban || (debtorAccounts ? (debtorAccounts[debtorType] || debtorAccounts[&#39;CTA_AHORROS&#39;]) : &#39;EC5002051000000000020501052673&#39;);
  var creditorIban = overrides.creditorIban || (creditorAccounts ? (creditorAccounts[creditorType] || creditorAccounts[&#39;CTA_CORRIENTE&#39;]) : &#39;EC0403031000000000030101002222&#39;);
  if (overrides.sameIban){
    creditorIban = debtorIban;
  }
  var msgId = overrides.msgId || (coopCode + token.currentDate + randomDigits(11));
  var endToEndId = overrides.endToEndId || (coopCode + token.currentDate + randomDigits(5));
  var amountValue = overrides.amount != null ? overrides.amount : 1.00;
  var payload = {
    GrpHdr: {
      msgId: msgId,
      creDtTm: timestamp,
      nbOfTxs: overrides.nbOfTxs || 1,
      sttlmInf: { sttlmMtd: overrides.settlementMethod || &#39;INGA&#39; },
      instgAgt: { finInstnId: coopCode },
      InstdAgt: { FinInstnId: overrides.instdAgtFinInstId || creditorEntity },
      Mge: { Type: overrides.messageType || &#39;acmt.998.321.01&#39; },
      ChnlId: overrides.channel || &#39;APP&#39;
    },
    CdtTrfTxInf: {
      PmtId: { EndToEndId: endToEndId },
      IntrBkSttlmAmt: { Amt: amountValue, Ccy: overrides.currency || &#39;USD&#39; },
      DbtrAcctId: { IBAN: debtorIban },
      CdtrAcctId: { IBAN: creditorIban },
      Prtry: {
        CustRef: overrides.customerReference || &#39;QA22&#39;,
        ChanRef: overrides.channelReference || (overrides.channel === &#39;QR&#39; ? &#39;QRPANAPAY&#39; : &#39;TERM001&#39;),
        AgtRef: overrides.agentReference || &#39;AGT0002&#39;
      }
    }
  };
  if (overrides.prtryOverrides){
    Object.keys(overrides.prtryOverrides).forEach(function(key){
      payload.CdtTrfTxInf.Prtry[key] = overrides.prtryOverrides[key];
    });
  }
  if (overrides.overrideHeaders){
    payload.GrpHdr.instgAgt = overrides.overrideHeaders.instgAgt || payload.GrpHdr.instgAgt;
    payload.GrpHdr.InstdAgt = overrides.overrideHeaders.instdAgt || payload.GrpHdr.InstdAgt;
  }
  return payload;
}</div>

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.111">
      <div class="step-ref bg-step">111</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def verifyTransferOutcome =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.111">function(body, expectation){
  expectation = expectation || {};
  var txInfo = (body &amp;&amp; body.CdtTrfTxInf) ? body.CdtTrfTxInf : {};
  var outcome = expectation.outcome || &#39;success&#39;;
  var requireTxOk = expectation.requireTxOk === true;
  var requireTxReject = expectation.requireTxReject === true;
  var expectedTxStatus = expectation.expectedTxStatus;
  if (expectedTxStatus != null){
    karate.match(txInfo.TxSts, expectedTxStatus);
  } else if (outcome === &#39;success&#39; &amp;&amp; requireTxOk){
    karate.match(txInfo.TxSts, &#39;Ok&#39;);
  } else if (outcome === &#39;reject&#39; &amp;&amp; requireTxReject){
    karate.match(txInfo.TxSts, &#39;#? _ &amp;&amp; _ != &quot;Ok&quot;&#39;);
  } else {
    if (txInfo &amp;&amp; txInfo.TxSts){
      karate.log(&#39;TxSts recibido:&#39;, txInfo.TxSts, &#39;- no se valida estrictamente.&#39;);
    } else {
      karate.log(&#39;Sin TxSts en la respuesta, continuando sin validacion.&#39;);
    }
  }
  if (outcome === &#39;pending&#39;){
    karate.match(txInfo.TxSts, &#39;#? _ == &quot;PENDING&quot; || _ == &quot;PROC&quot;&#39;);
  }
  if (expectation.reasonCode){
    var reasonNode = txInfo.Rsn || {};
    karate.match(reasonNode.RsnCd, expectation.reasonCode);
  }
  if (expectation.expectedEndToEndId){
    karate.match(txInfo.PmtId.EndToEndId, expectation.expectedEndToEndId);
  }
  if (expectation.expectedMsgId){
    var grpHdr = (body &amp;&amp; body.GrpHdr) ? body.GrpHdr : {};
    karate.match(grpHdr.msgId, expectation.expectedMsgId);
  }
}</div>

  

     

  

</div>
</div>
          <div data-parent="[25:450]bg"><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.151">
      <div class="step-ref bg-step">151</div>
      
      <div class="step-cell passed">
        <span>*</span>&nbsp;<span>def logTransferSummary =</span>
      </div>
    </div>
    <div class="time-cell passed">0</div>
  </div>

   
  
  <div class="preformatted" data-parent="0.151">function(name, payload, responseBody, status){
  karate.log(&#39;[Transfer]&#39;, name, &#39;| status:&#39;, status, &#39;| msgId:&#39;, payload.GrpHdr.msgId, &#39;| endToEnd:&#39;, payload.CdtTrfTxInf.PmtId.EndToEndId);
}</div>

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.451">
      <div class="step-ref failed">451</div>
      
      <div class="step-cell failed">
        <span>*</span>&nbsp;<span>def expiredHeaders = karate.clone(authHeaders)</span>
      </div>
    </div>
    <div class="time-cell failed">45</div>
  </div>

   
  
  

  

  <div class="preformatted" data-parent="0.451">14:15:30.137 classpath:Transferencia.feature:451
* def expiredHeaders = karate.clone(authHeaders)
js failed:
&gt;&gt;&gt;&gt;
01: karate.clone(authHeaders)
&lt;&lt;&lt;&lt;
org.graalvm.polyglot.PolyglotException: TypeError: invokeMember (clone) on com.intuit.karate.core.ScenarioBridge failed due to: Unknown identifier: clone
- &lt;js&gt;.:program(Unnamed:1)

classpath:Transferencia.feature:451
</div>   

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.452">
      <div class="step-ref skipped">452</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>set expiredHeaders.Authorization = &#39;Bearer EXPIRED-&#39; + tokenData.auth_tokencb</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.453">
      <div class="step-ref skipped">453</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>configure headers = expiredHeaders</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.454">
      <div class="step-ref skipped">454</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def payload = buildPayload()</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.455">
      <div class="step-ref skipped">455</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def expectation = { httpStatus: [401, 403], outcome: &#39;reject&#39; }</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.456">
      <div class="step-ref skipped">456</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>def normalizedStatus = normalizeStatus(expectation.httpStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.457">
      <div class="step-ref skipped">457</div>
      
      <div class="step-cell skipped">
        <span>Given</span>&nbsp;<span>path &#39;finan&#39;, &#39;transferencia&#39;</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.458">
      <div class="step-ref skipped">458</div>
      
      <div class="step-cell skipped">
        <span>And</span>&nbsp;<span>request payload</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.459">
      <div class="step-ref skipped">459</div>
      
      <div class="step-cell skipped">
        <span>When</span>&nbsp;<span>method post</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.460">
      <div class="step-ref skipped">460</div>
      
      <div class="step-cell skipped">
        <span>Then</span>&nbsp;<span>match responseStatus in normalizedStatus</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.461">
      <div class="step-ref skipped">461</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>configure headers = authHeaders</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.462">
      <div class="step-ref skipped">462</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval verifyTransferOutcome(response, expectation)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
          <div><div>
  

  

  <div class="step-row">
    <div class="step-container" id="0.463">
      <div class="step-ref skipped">463</div>
      
      <div class="step-cell skipped">
        <span>*</span>&nbsp;<span>eval logTransferSummary(&#39;Token expirado&#39;, payload, response, responseStatus)</span>
      </div>
    </div>
    <div class="time-cell skipped">0</div>
  </div>

   
  
  

  

     

  

</div>
</div>
        </div>
      </div>
    </div>
  </body>
</html>

